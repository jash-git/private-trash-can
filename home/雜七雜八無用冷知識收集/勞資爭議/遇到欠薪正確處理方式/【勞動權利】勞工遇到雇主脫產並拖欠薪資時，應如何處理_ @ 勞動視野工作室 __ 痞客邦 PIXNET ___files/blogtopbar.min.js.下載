window.requestTimeout=function(t,e){"use strict";function a(){var r=(new Date).getTime(),o=r-n;o>=e?t.call():i.value=window.requestAnimFrame(a)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setTimeout(t,e);var n=(new Date).getTime(),i={};return i.value=window.requestAnimFrame(a),i},window.clearRequestTimeout=function(t){return window.cancelAnimationFrame?window.cancelAnimationFrame(t.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(t.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(t.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(t.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(t.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(t.value):clearTimeout(t)},window.requestAnimFrame=function(){"use strict";return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),function(t){"use strict";var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t.fn.replaceTpl=function(t,a){var n=/\#\{\$(.+?)\}/g,i=e;return t.replace(n,function(t){return String(a[t.replace(n,"$1")]).replace(/[&<>"'\/]/g,function(t){return i[t]})})}}(jQuery),function(t){"use strict";t.support.cssProperty=function(t){for(var e=",Webkit,Moz,O,ms,Khtml".split(","),a=e.length,n=!1,i=0;a>i&&(i&&(t=t.charAt(0).toUpperCase()+t.substr(1)),!(n=e[i]+t in document.body.style));i++);return n}}(jQuery),function(t,e,a){"use strict";var n=function(){if(-1===navigator.userAgent.indexOf("MSIE"))return!1;var t=parseInt(navigator.userAgent.split("MSIE")[1].split(";")[0]);return 9>=t}();t.fn.Search=function(i){var r=this,o=i.jqSearch,s=i.jqSearchInput,c=i.jqSearchBtn,l=i.jqSearchReset,d=i.jqSearchSuggestion,u={show:i.suggestionShowClass,item:i.suggestionItemClass,selected:i.suggestionSelectedClass};this.searchSuggestion=function(){var a={kwdCached:{},kwdTpl:{item:i.suggestionItemTpl,mark:"<mark>$1</mark>"}},n=d;return a.getKwd=function(e){if(e=t.trim(String(e)),!e.length)return a.hideKwd(),void 0;var i=a.setKwdCount();a.kwdCached[e]?a.showKwd(a.kwdCached[e],e):!function(i){t.ajax({url:"//emma.pixnet.cc/mainpage/keywords/search.json?sort=count&limit=10&q="+e,dataType:"jsonp"}).done(function(t){var r=t.keywords;t.error||(r.length?(a.kwdCached[e]=r,i===n.data("kwd-counter")&&a.showKwd(r,e)):a.hideKwd())})}(i)},a.setKwdCount=function(){var t,e=n.data("kwd-counter")||0;return n.data("kwd-counter",e+1),t=n.data("kwd-counter")},a.hideKwd=function(t){t&&n.empty(),n.removeClass(u.show)},a.showKwd=function(e,i){for(var r,o=0,s=e.length,c="",l=t("<ul />"),d=new RegExp("("+i.replace(/(\W)/g,"\\$1")+")","gi");s>o;o+=1)r=l.html(t.fn.replaceTpl(a.kwdTpl.item,{keyword:e[o]})).children("li"),r.html(r.html().replace(d,a.kwdTpl.mark)),c+=l.html();n.html(c).addClass(u.show),c=l=r=null},a.fillKwd=function(t){var e=n.find("."+u.selected);e.length&&(t=t||e.text(),s.val(t))},a.selectKwd=function(t){if(27===t)return a.hideKwd(),s.val(e.unescape(s.data("kwd"))),void 0;n.addClass(u.show);var i=n.find("li"),r=i.length,o=i.filter("."+u.selected).index(),c=38===t?-1:1,l=(o+c)%r;i.length||a.getKwd(s.val()),i.removeClass(u.selected).eq(l).addClass(u.selected),a.fillKwd()},a}(),this.checkSearchVal=function(){""===s.val()?l.hide():l.show()},this.validateForm=function(){return 0!==s[0].value.length},this.submitCount=function(t,n){var i,r=new Image(1,1),o=function(){e.clearRequestTimeout(i),a.location.href=n};r.src=t,r.onload=o,r.onerror=o,i=e.requestTimeout(o,500)},this.submit=function(){var t,e=c.find("button").eq(0),a=e.val(),n=e.data("counterlink"),i=s[0].maxLength;i<s[0].value.length&&s.val(s.val().slice(0,i)),t=o.attr("action")+"?"+o.serialize()+"&search="+a,t&&r.submitCount(n,t)},this.init=function(){if(c.on("click.switch","button",function(){var e=t(this);0!==e.index()&&c.prepend(e)}),i.autoFocusBtn){var p=location.pathname.split(/^\//)[1],f=c.find("button").filter('[value="'+p+'"]');e.setTimeout(function(){f.trigger("click.switch")},0)}o.on("submit.check",function(t){t.preventDefault(),r.validateForm()&&r.submit()}),s.on({"input.reset change.reset":r.checkSearchVal,"input.kwd change.kwd focus.kwd":function(){r.searchSuggestion.getKwd(s.val())}}),i.suggestionKeyboard&&s.on({"keydown.kwdCtrl input.kwdCtrl":function(t){var a=t.keyCode,i=s.val();switch(a){case 27:case 38:case 40:t.preventDefault(),r.searchSuggestion.selectKwd(a);break;default:n&&r.searchSuggestion.getKwd(i),s.data("kwd",e.escape(i))}}}),l.on("click.reset",function(t){t.preventDefault(),s[0].value="",r.checkSearchVal(),r.searchSuggestion.hideKwd()}),d.on("mouseenter",function(){s.blur()}).on("mouseenter.selectKwd","."+u.item,function(){t(this).siblings().removeClass(u.selected).end().addClass(u.selected)}).on("mouseleave.selectKwd","."+u.item,function(){t(this).removeClass(u.selected)}).on("click.suggestion","."+u.item,function(){r.searchSuggestion.fillKwd(),r.searchSuggestion.hideKwd(),o.submit()}),t(a).on("click.suggestion",function(e){0===t(e.target).parents().filter(o).length&&r.searchSuggestion.hideKwd()})}}}(jQuery,window,document),function(t,e,a,n,i){"use strict";t(function(){var r,o,s,c,l,d,u=function(){if(-1===navigator.userAgent.indexOf("MSIE"))return!1;var t=parseInt(navigator.userAgent.split("MSIE")[1].split(";")[0]);return 9>=t}(),p="is-active";r=function(t){return a.getElementById(t)},d={},d.win=t(e),d.doc=t(a),d.topbar=function(){var e=t(r("topbar")),a=e.find(".topbar__search"),n=e.find(".topbar__nav");return{topbar:e,search:a,announce:e.find(".topbar__announce"),relatedArticle:e.find(".topbar__related-article__block"),nav:n,searchContainer:n.find(".topbar__search-container"),notification:t(".topbar__nav .topbar__notification"),user:n.find(".topbar__user")}}(),s=function(t){var a=t.jqAnnounce,n=a.find("a"),i=t.hideClass,r={index:0,total:n.length,duration:t.duration};this.carousel=function(){!function t(){e.setTimeout(function(){var e=r.index;r.index=(e+1)%r.total,n.eq(e).add(n.eq(r.index)).toggleClass(i),t()},r.duration)}()},this.init=function(){this.carousel()}},l=function(){var n,i,r,o,s,c=this,l="block"===a.getElementsByTagName("body")[0].dataset.adsenseState;this.addTabData=function(t,e){var a=function(t){for(var e=[],a=0;a<t.length;a++){var n=c.url2ArticleData(t.eq(a).attr("href"));e.push(n)}return e}(e.find("a"));t.push({displayed:!1,name:e.data("tab-name"),articles:a})},this.deleteTabDataLastArticle=function(t){o[t].articles[4]=!1},this.pushPaEvent=function(t,e,a,n){if(n){var i=e+": "+(r.cityName||r.articleCat)+" "+a;_piq.push(["trackEvent",t,i,n])}},this.pushGaEvent=function(t,e,a){ga("topbarAarticlesTracker.send","event",t,e,a)},this.appendAd=function(e){for(var a='<li class="topbar__related-article__cat" data-tab-name="廣告"><div class="topbar__related-article__txt topbar__related-article__txt--hot">'+e[0].name+'</div><div class="topbar__related-article__showcase"><ul class="topbar__related-article-list">',n='<li class="topbar__related-article"><a class="topbar__related-article-link" href="{{ URL }}" target="_blank"><div class="topbar__related-article__img"><img src="{{ THUMB }}" onerror="this.remove()"></div><div class="topbar__related-article__title">{{ TITLE }}</div></a></li>',i=0;i<e.length;i++)a+=n.replace("{{ URL }}",e[i].click_url).replace("{{ TITLE }}",e[i].title).replace("{{ THUMB }}",e[i].file);a+="</ul></div></li>",c.addTabData(o,t(a)),d.topbar.relatedArticle.find(".topbar__related-article__showcase-block").before(a)},this.appendTabAds=function(t,e){var a,n='<a class="topbar__related-article-link" href="{{ URL }}" target="_blank"><div class="topbar__related-article__img"><img src="{{ THUMB }}" onerror="this.remove()"></div><div class="topbar__related-article__title">{{ TITLE }}</div></a>',i=d.topbar.relatedArticle.find(".topbar__related-article__cat").eq(e).find(".topbar__related-article").last();"image"===t[0].type&&(a=n.replace("{{ URL }}",t[0].click_url).replace("{{ TITLE }}",t[0].title).replace("{{ THUMB }}",t[0].file),c.deleteTabDataLastArticle(e),i.html(a))},this.appendGeneralTabAd=function(t,e){var a,n=d.topbar.relatedArticle.find(".topbar__related-article__cat").eq(e).find(".topbar__related-article").last();"js"===t[0].type&&(a=t[0].content,c.deleteTabDataLastArticle(e),n.html(a))},this.trackTabImpsEvent=function(t){var e=o[t],a=i+e.name,s="TAB ";c.pushPaEvent("TOPBAR 成效","imps",e.name,n);for(var l=0;5>l;l++)c.pushPaEvent("TOPBAR 推薦文章成效","imps",e.name,e.articles[l]);r.displayed||(r.displayed=!0,c.pushGaEvent("TOP BAR displayed","displayed")),e.displayed||(e.displayed=!0,c.pushGaEvent(s+"displayed",a)),c.pushGaEvent(s+"imps",a)},this.variableInit=function(){r=function(e){return{displayed:!1,cityName:e.travelCity,articleCat:e.articlesCategory,articlesType:e.articlesType,testVariation:e.testVariation,articleCatId:t(".article-head > .title").data("site-category-id")}}(d.topbar.relatedArticle.data()),o=function(t){for(var e=[],a=0;a<t.length;a++)c.addTabData(e,t.eq(a));return e}(d.topbar.relatedArticle.find(".topbar__related-article__cat")),n=c.url2ArticleData(location.href),i="TAB_"+r.articlesType+"_",s="固定"===r.articlesType},this.gaInit=function(){!function(t,e,a,n,i,r,o){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*new Date,r=e.createElement(a),o=e.getElementsByTagName(a)[0],r.async=1,r.src=n,o.parentNode.insertBefore(r,o)}(e,a,"script","//www.google-analytics.com/analytics.js","ga");var t=function(){return r.testVariation?"UA-69603077-4":s?"UA-71151682-3":"UA-71151682-1"}();ga("create",t,"auto",{name:"topbarAarticlesTracker"}),ga("topbarAarticlesTracker.set","contentGroup1",r.cityName),ga("topbarAarticlesTracker.set","contentGroup2",r.articleCat),ga("topbarAarticlesTracker.set","contentGroup3",r.testVariation),ga("topbarAarticlesTracker.send","pageview")},this.injectAd=function(){var e=function(){var t=new RegExp("[\\?&]demo_ad_no=([^&#]*)"),e=t.exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}(),a="1754,2020,2023,2026,2029,2032";s&&(a="2116,2011,2014,2017"),t.ajaxSetup({cache:!0}),t.ajax({url:"https://falcon.pixanalytics.com/ad/json/"+a,dataType:"json",data:{version:2,ad_limit:5,demo_ad_no:e,blog_category:t("body").data("blog-site-category-id"),article_category:r.articleCatId}}).done(function(t){if(!t.error)for(var e=0,a=t.ad_slots.length;a>e;e++)t.ad_slots[e]&&t.ad_slots[e].ad_num&&(0!==e?""===t.ad_slots[e].ad_list[0].content||l?c.appendTabAds(t.ad_slots[e].ad_list,e-1):c.appendGeneralTabAd(t.ad_slots[e].ad_list,e-1):c.appendAd(t.ad_slots[e].ad_list))}),t.ajaxSetup({cache:!1})},this.bindEvents=function(){d.topbar.relatedArticle.on("click",".topbar__related-article-link",function(){var e=t(this).parent(),a=e.parent().index(".topbar__related-article-list"),r=e.index(),l=o[a],d=l.articles[r],u={cat:"推薦文章_click",action:i+l.name,label:"content_"+(r+1)};c.pushGaEvent(u.cat,u.action,u.label),s||(c.pushPaEvent("TOPBAR 成效","click",l.name,n),c.pushPaEvent("TOPBAR 推薦文章成效","click",l.name,d))}),s||d.topbar.relatedArticle.on("mouseenter",".topbar__related-article__cat",function(){var e=t(this).index(".topbar__related-article__cat");c.trackTabImpsEvent(e)})},this.bookingLinkTest=function(){function t(t){var a="imps"!==t;ga("topbarBookingLink.send","event","Booking.com",t,e,{nonInteraction:!a})}var e,a=d.topbar.relatedArticle.find(".topbar__related-article__link");a.length&&(e=a.data("test-version"),ga("create","UA-69603077-4","auto",{name:"topbarBookingLink"}),ga("topbarBookingLink.send","pageview"),t("imps"),a.on({mouseenter:function(){t("mouse over")},click:function(){t("click")}}))},this.init=function(){c.variableInit(),c.gaInit(),c.injectAd(),c.bindEvents(),c.bookingLinkTest()},this.url2ArticleData=function(t){try{var e=t.split("//")[1].split(".")[0],a=t.split("/post/")[1].split("?")[0].split("-")[0];return e+" "+a}catch(n){return!1}}},o=function(){var a=this,n=d.topbar.notification,r=n.find(".topbar__notification__counter"),o=n.find(".topbar__dropdown-lists"),s=n.find(".topbar__flip"),c=n.find(".topbar__notification__msglists"),l=parseFloat(c.css("min-height"),10),u=parseFloat(c.css("max-height"),10),f=150+u,h=6e4,m=60*h,g=24*m;this.transTime=function(t){var e=new Date(t);return{Y:e.getYear(),M:e.getMonth()+1,D:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds()}},this.formatTime=function(t,e){var n,i,r,o=t-e,s=a.transTime,c=s(e);switch(o/g|0){case 0:r=o/m|0,i=(o/h|0)-60*r,n=1>r?i?i+"分鐘前":"剛剛":r+"小時前";break;case 1:n="昨天"+c.h+":"+c.m;break;default:n=c.M+"月"+c.D+"日"}return n},this.formatMsgDate=function(e){for(var n,i,r,o=t("<ul />"),s=o.html(e).find(".topbar__notification__msglist__time"),c=new Date,l=s.length-1;l>=0;l--)n=new Date(1e3*t(s[l]).text()),i=a.formatTime(c,n),r=n.toLocaleString(),t(s[l]).html(i).attr({title:r}),n=i=null;return e=o.html()},this.ajaxCounter=function(t){if(t)return t===n.data("ajax-counter");var e=n.data("ajax-counter")||0,a=e+1;return n.data("ajax-counter",a),a},this.getData=function(){if(!n.hasClass("ajax-loading")&&!o.hasClass(p)){if(n[0].className=n.data("className"),n.addClass("ajax-loading"),"0"===r.attr("data-counter")&&n.data("latestNotification"))return c.html(a.formatMsgDate(n.data("latestNotification").html)),setTimeout(function(){n.removeClass("ajax-loading")},0),void 0;var e=a.ajaxCounter();t.ajaxSetup({cache:!0}),t.ajax({url:"//api.pixnet.cc/notification/notifyentries",dataType:"json",xhrFields:{withCredentials:!0}}).done(function(t){t.error?n.addClass("ajax-error"):(n.addClass("ajax-success").data("latestNotification",t),a.ajaxCounter(e)&&t.latestTime!==n.data("latestTime")&&(c.html(a.formatMsgDate(t.html)),n.addClass("ajax-done"),a.latestTime(t.latestTime)),a.counterNum(0))}).fail(function(){n.addClass("ajax-error")}).always(function(){setTimeout(function(){n.removeClass("ajax-loading")},0)})}},this.resize=function(){var t=d.win.height();f>t&&t>l&&c.css("max-height",t-150)},this.latestTime=function(t){return t?(n.data("latestTime",t),void 0):n.data("latestTime")},this.counterNum=function(t){var e,a,n="no-notification";return t===i?r.attr("data-counter"):(t=Number(t),e=r.hasClass(n),a=0===t,a||e?a!==e&&(r.attr("data-counter",t),r.toggleClass(n)):r.attr("data-counter",t),void 0)},this.toggleShowHide=function(){r.on("click",function(t){t.preventDefault(),a.getData(),r.toggleClass(p),o.toggleClass(p),a.resetFlip()}),d.doc.on("click",function(e){var a=e.target,i=t(a).parents().filter(n).length;i||(r.removeClass(p),o.removeClass(p))})},this.resetFlip=function(){s.removeClass("is-flipping")},this.toggleFlip=function(){s.toggleClass("is-flipping")},this.checkUnreadNotiCount=function(){!function i(){e.setTimeout(function(){var r=n.data("latestTime"),o=a.counterNum();t.ajaxSetup({cache:!0}),t.ajax({url:"//api.pixnet.cc/notification/getunreadnotifyinfo",type:"GET",dataType:"json",data:{latestTime:r},xhrFields:{withCredentials:!0}}).done(function(t){var e=t.unreadNotifyCount;e&&e!==o&&a.counterNum(e)}).fail(function(){e.console&&e.console.log("ajax error: /api/getunreadnotifyinfo")}).always(function(){i()})},6e4)}()},this.init=function(){n.data("className",n[0].className),d.win.on("resize.notification",a.resize),a.toggleShowHide(),n.find(".topbar__notification__list--header__title").on("click",a.toggleFlip),n.find(".topbar__flip--back").on("click",function(t){t.preventDefault(),a.toggleFlip()}),a.checkUnreadNotiCount(),e.setTimeout(function(){d.win.trigger("resize.notification")},0)}},c=function(){var e=d.topbar.searchContainer.find(".topbar__search__toggle-btn");this.init=function(){e.on("click",function(){d.topbar.search.toggle(),e.toggleClass(p)}),d.doc.on("click",function(a){var n=a.target,i=t(n).parents().filter(d.topbar.searchContainer).length;i||(d.topbar.search.toggle(!1),e.toggleClass(p,!1))})}},function(){function e(){var t=a.getElementsByClassName("main-container");0!==t.length&&(t=t[0],d.topbar.topbar.removeClass("topbar--fixed"),d.win.on("scroll.elementfixed",function(){var e=t.getBoundingClientRect().top<=0;d.topbar.topbar.toggleClass("topbar--fixed",e)}))}d.topbar.topbar.addClass(function(){var e=["cssanimations","borderradius","boxshadow","cssgradients"];try{for(var a=[t.support.cssProperty("animation"),t.support.cssProperty("borderRadius"),t.support.cssProperty("boxShadow"),!u],n=a.length-1;n>=0;n--)a[n]||(e[n]="no-"+e[n])}catch(i){console.warn("$.support undefined"),u&&(e[3]="no-"+e[3])}return e.join(" ")}),n.f||(n.f={}),n.f.topbar=n.f.topbar||{option:{search:!0,announce:!0,notification:!0,searchContainer:!0,relatedArticle:!0}};var i=function(){var t=d.topbar.search;return{jqSearch:t,jqSearchInput:t.find(".topbar__search__input"),jqSearchBtn:t.find(".topbar__search__btns"),jqSearchReset:t.find(".topbar__search__reset"),jqSearchSuggestion:t.find(".topbar__search__suggestion"),suggestionItemTpl:'<li class="topbar__search__suggestion__item">#{$keyword}</li>',suggestionItemClass:"topbar__search__suggestion__item",suggestionShowClass:"topbar__search__suggestion--show",suggestionSelectedClass:"topbar__search__suggestion__item--selected",suggestion:!0,suggestionKeyboard:!0,autoFocusBtn:!1}}(),r={jqAnnounce:d.topbar.announce,hideClass:"topbar__announce__item--hide",duration:6e3};t.fn.Search&&(n.f.topbar.search=new t.fn.Search(i)),n.f.topbar.announce=new s(r),d.topbar.notification.length&&(n.f.topbar.notification=new o),d.topbar.searchContainer.length&&(n.f.topbar.searchContainer=new c),d.topbar.relatedArticle.length&&(n.f.topbar.relatedArticle=new l);for(var p in n.f.topbar)n.f.topbar.hasOwnProperty(p)&&"option"!==p&&n.f.topbar.option[p]&&n.f.topbar[p].init();e()}()}),function(){function i(){e.innerWidth>=1280&&(y.addClass("show-sidebar"),A=!0),k.on("scroll.sidebarshift",function(){if(A){if(T.css("left",-e.pageXOffset),C.hasClass("topbar--fixed")){var t=Math.max(220-e.pageXOffset,0);C.css("left",t)}_&&(x=k.scrollTop()-C.offset().top>=0,T.toggleClass("sidebar--fixed",x),x||C.attr("style",""))}}),k.on("resize.toggleSidebar",function(){!A&&e.innerWidth>=1280?A=!0:A&&e.innerWidth<1280&&(T.attr("style",""),C.attr("style",""),A=!1),y.toggleClass("show-sidebar",A)}),T.on("click",".keyword-tag",function(){for(var e=t(this).index(),a=T.find(".keyword-tag"),n=0;n<a.length;n++)a.eq(n).toggleClass("active",e===n);T.find(".keyword-articles-container").css("margin-left",-220*e+"px"),l(v,"tab imps",t(this).text())}),T.on("click",".keyword-article",function(){var e=t(this).parent().index(),a=t(".keyword-tag").eq(e).text(),n=o(this.href);l(v,"article clicked",a),n&&_piq.push(["trackEvent","search sidebar - click article",a,n.author,n.id])}),setTimeout(function(){_=t("#mib-video-expander").length,_&&(x=!1,T.removeClass("sidebar--fixed"))},0)}function r(t){return t.split("//")[1].split("#")[0].split("?")[0].split("-")[0].replace(/.\w+\.test\.pixnet/,"").replace(/.\w+\.alpha\.pixnet/,"")}function o(t){var e=r(t).split(".pixnet.net/blog/post/");return 2===e.length&&parseInt(e[1])?{id:parseInt(e[1]),author:e[0]}:!1}function s(){var t="; "+a.cookie,e=t.split("; keyword_sidebar=");return 2>e.length?{}:JSON.parse(e[1].split(";")[0])}function c(t,e){var n=s(),i=r(location.href);n[i]=t+","+e,a.cookie="keyword_sidebar="+JSON.stringify(n)+";domain=."+location.host.replace(/\w+\./,"")+";path=/"}function l(t,e,a){var n="article clicked"===e;ga("sidebarTracker.send","event",t,e,a,{nonInteraction:!n})}function d(){!function(t,e,a,n,i,r,o){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*new Date,r=e.createElement(a),o=e.getElementsByTagName(a)[0],r.async=1,r.src=n,o.parentNode.insertBefore(r,o)}(e,a,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-65168598-14","auto","sidebarTracker"),ga("sidebarTracker.send","pageview"),S&&l("from search","1. sampling")}function u(){var t=s(),e=function(){return a.referrer?r(a.referrer):""}();e&&t[e]&&(w=function(){var a=t[e].split(",");return 2!==a.length?!1:{username:a[0],id:a[1]}}(),q||f())}function p(){w=b,f()}function f(){if(w){t.ajaxSetup({cache:!0});var e=t.ajax({url:"http://emma.pixnet.cc/blogarticles/topkeywords",dataType:"json",data:{user_name:w.username,article_id:w.id}}),a=t.ajax({url:"https://emma.pixnet.cc/blog/articles/"+w.id,dataType:"json",data:{user:w.username}}),n=t.ajax({url:"http://emma.pixnet.cc/blog/articles/"+w.id+"/ypa",dataType:"json",data:{user:w.username}});t.ajaxSetup({cache:!1}),t.when(a,e,n).done(function(t,e,a){if(d(),t[0]&&!t[0].error&&e[0]){if(S){if(l("from search","2. in search console"),q)return;l("from search","3. sidebar exist")}m(t[0].article,e[0],a[0])}})}}function h(e){function n(t){return encodeURIComponent(t).replace(/(%[A-F\d]{2}){3}/g,"UU").length}function i(t,e){if(t=t.replace(/\n/g,""),n(t)<=2*e)return t;for(var a=e;a<t.length;a++){var i=t.substr(0,a);if(n(i)>2*e)return t.substr(0,a-1)+"..."}}var o="",s="",c='<span class="keyword-tag {% ACTIVE %}">{% KEYWORD %}</span> ',d='<a class="keyword-article keyword-article-min70 {% ACTIVE %}" href="{% LINK %}"><h3 class="keyword-article__title">{% TITLE %}</h3></a>',u=r(location.href),p=function(t,e,a){var n=r(t.url)===u?"active":"";return a&&(t.title=i(t.title,25)),d.replace("{% ACTIVE %}",n).replace("{% LINK %}",t.url).replace("{% TITLE %}",t.title)},f=0;t.each(e.keywordsArticles,function(t,n){var i=o?"":"active";o+=c.replace("{% KEYWORD %}",t).replace("{% ACTIVE %}",i),s+='<div class="keyword-articles">',s+=p(e.topArticle,t,!0);for(var r=0;r<n.length;r++)if(s+=p(n[r],t),3===r%4){var l=(r-3)/4,d=e.ypaIframes[(r-3)/4],u="w_sidebar_"+d.type+"_h"+(new Date).getHours()+"_"+a.location.hostname.slice(0,1),h="sidebar_ypa_"+f+"_"+l,m='<iframe class="sitemaji-ypa-ad" src="http://pixnet.net/pixnet_ypa_iframe.html?q='+d.q+"&site="+u+"&cssdesktop="+d.cssUrl+"&adcount=1&id="+h+'" frameborder="0" style="width:100%"></iframe>';s+=m}s+="</div>",f++}),T.find(".keyword-tags").html(o),T.find(".keyword-articles-container").html(s).css("top",T.find(".keyword-tags").height()+55),l(v,"tab imps",t(".keyword-tag").eq(0).text())}function m(t,e,a){(!a||a.error)&&(a={ypa:[]}),h({topArticle:{title:t.title,url:t.link},keywordsArticles:e,ypaIframes:a.ypa}),i(),c(w.username,w.id),T.find(".sitemaji-ypa-ad").each(function(){this.src=this.src})}function g(t){var a=new RegExp("[?&]"+t+"=([^&]*)").exec(e.location.search);return a&&decodeURIComponent(a[1].replace(/\+/g," "))}var w,_,b=function(){var e="",a="";if(n.visitor)a=n.visitor;else if(location.href.match(/\/blog\/post\/\d+/))try{e=t("meta[name=author]").attr("content").split(" ("),a=e[e.length-1].split(")")[0]}catch(i){console.warn("can not get username")}return{username:a,id:t("body").data("article-id")}}(),v=b.username+" "+b.id,k=t(e),y=t("body"),T=t(".sidebar"),C=t("#topbar"),A=!1,x=!0,j=["sweetmemory99","meiko1101","zine1215","ahuiliao"].indexOf(b.username.toLowerCase())+1,q=T.data("obstruct"),S=function(t){return t?t.match(/www\.google\.com/)||t.match(/search\.yahoo\.com/)||t.match(/www\.bing\.com/)||t.match(/www\.pixnet\.net\/searcharticle/)?!0:T.data("search"):"search"===T.data("search")}(a.referrer),E=function(){var t=new Date;return t>=new Date("2016-05-04 16:00")&&t<new Date("2016-05-09 16:00")}();(b&&b.id||location.href.match(/www.pixnet.net/))&&(g("show_sidebar")&&(q=!1,j=!0,E=!0,S=!0),j&&E&&(S||q||u(),S&&p()))}()}(jQuery,window,document,pix);